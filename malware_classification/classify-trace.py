#!/usr/bin/env python3

import sys

import skops.io as sio
from pandas import DataFrame
from sklearn.feature_extraction.text import CountVectorizer

import preprocessing


def test_model(filename: str):
    # print("Loading model...")
    vectorizer = sio.load('vectorizer.skops')
    model = sio.load('model.skops')

    with open(filename, 'r') as f:
        # print("Preprocessing dataset...")
        trace = preprocessing.shorten_sequences(f.read().splitlines())
        count_vector = vectorizer.transform(trace)

        df = DataFrame(
            data=count_vector.toarray(),
            columns=vectorizer.vocabulary
        )
        y_pred = model.predict(df)
        for pred in y_pred:
            print(pred)
        # with open('output.txt', 'w') as out:
        #     y_pred.tofile(out, sep='\n')


if __name__ == '__main__':
    if len(sys.argv) < 2:
        print('Usage classify-trace.py <filename>')
        exit(1)
    test_model(sys.argv[1])